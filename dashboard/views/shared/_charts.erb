<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
  // Load the Visualization API and the piechart package.
  google.load('visualization', '1.0', {'packages':['corechart']});
</script>

<% charts.each do |chart| %>
  <div id="<%= chart.dom_id %>"></div>
  <script type="text/javascript">
    // Set a callback to run when the Google Visualization API is loaded.
    google.setOnLoadCallback(
      function(){
        var data = new google.visualization.DataTable(jQuery.parseJSON('<%= chart.data.to_json %>'));
        var options = jQuery.parseJSON('<%= chart.options.to_json %>');
        var div = document.getElementById('<%= chart.dom_id %>');
        new google.visualization.LineChart(div).draw(data, options);
    });

  </script>
<% end %>
